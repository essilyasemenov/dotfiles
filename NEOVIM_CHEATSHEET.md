# Neovim — Шпаргалка

## Зачем это всё?

Vim/Neovim — это не обычный текстовый редактор. Здесь нельзя просто открыть файл и начать печатать. Вместо этого Vim разделяет работу на **режимы**: в одном ты перемещаешься по тексту, в другом — печатаешь, в третьем — выделяешь. Это непривычно, но позволяет редактировать текст очень быстро.

Главная идея: команды строятся как **действие + объект**. Например, `dw` — это "вырезать слово" (`d` = вырезать, `w` = слово). Выучив несколько действий и несколько объектов, ты получаешь десятки комбинаций.

---

## Обозначения

| Запись | Что значит |
|--------|------------|
| `<Leader>` | Клавиша-модификатор — **Пробел**. Работает как Ctrl: зажимаешь и нажимаешь следующую клавишу |
| `C-x` | Ctrl+x |
| `A-x` | Alt/Option+x |
| `[count]` | Необязательное число перед командой. Например, `5j` — вниз на 5 строк |

---

## Режимы

В обычных редакторах нажал букву — она появилась на экране. В Vim всё иначе: буквы на клавиатуре — это **команды**. Чтобы начать печатать текст, нужно сначала войти в режим вставки.

| Клавиша       | Режим / действие                       |
|---------------|----------------------------------------|
| `Esc` / `C-[` | **Нормальный режим** — вернуться из любого режима. Здесь ты перемещаешься и даёшь команды |
| `i`           | Режим вставки — начать печатать перед курсором |
| `a`           | Режим вставки — после курсора          |
| `I`           | Режим вставки — в начале строки        |
| `A`           | Режим вставки — в конце строки         |
| `o`           | Создать строку ниже и начать печатать  |
| `O`           | Создать строку выше и начать печатать  |
| `s`           | Вырезать символ и начать печатать      |
| `S`           | Вырезать строку и начать печатать      |
| `v`           | Визуальный режим — выделение посимвольно (как Shift+стрелки) |
| `V`           | Визуальный режим — выделение целых строк |
| `C-v`         | Визуальный блочный режим — прямоугольное выделение |
| `R`           | Режим замены — печатаешь поверх существующего текста |
| `:`           | Командный режим — ввод команд (`:w` для сохранения и т.д.) |

---

## Движение курсора

### Базовое

| Клавиша   | Действие                           |
|-----------|------------------------------------|
| `h j k l` | ← ↓ ↑ → (вместо стрелок)         |
| `w`       | На начало следующего слова         |
| `b`       | На начало предыдущего слова        |
| `e`       | На конец текущего/следующего слова |
| `0`       | В начало строки                    |
| `^`       | На первый непробельный символ строки |
| `$`       | В конец строки                     |

### По файлу

| Клавиша | Действие                           |
|---------|------------------------------------|
| `gg`    | В начало файла                     |
| `G`     | В конец файла                      |
| `[N]G`  | На строку N (например, `42G`)      |
| `%`     | Перейти к парной скобке `() [] {}` |
| `C-u`   | Прокрутка вверх на полэкрана       |
| `C-d`   | Прокрутка вниз на полэкрана        |
| `zz`    | Центрировать текущую строку на экране |

### Продвинутое движение

| Клавиша | Действие                                 |
|---------|------------------------------------------|
| `W`     | На следующее СЛОВО (разделитель — только пробел) |
| `B`     | На предыдущее СЛОВО                      |
| `E`     | На конец текущего СЛОВА                  |
| `ge`    | На конец предыдущего слова               |
| `g_`    | На последний непробельный символ строки  |
| `H`     | Курсор на верхнюю строку экрана          |
| `M`     | Курсор на среднюю строку экрана          |
| `L`     | Курсор на нижнюю строку экрана           |
| `zt`    | Прокрутить: текущая строка — наверх      |
| `zb`    | Прокрутить: текущая строка — вниз        |
| `C-b`   | Прокрутка вверх на экран                 |
| `C-f`   | Прокрутка вниз на экран                  |
| `C-e`   | Прокрутка вниз на 1 строку              |
| `C-y`   | Прокрутка вверх на 1 строку             |
| `f{x}`  | Прыгнуть вперёд на символ x (например, `f.` — на ближайшую точку) |
| `F{x}`  | Прыгнуть назад на символ x              |
| `t{x}`  | Прыгнуть вперёд до символа x (курсор встанет перед ним) |
| `T{x}`  | Прыгнуть назад до символа x             |
| `;`     | Повторить последний f/F/t/T вперёд      |
| `,`     | Повторить последний f/F/t/T назад       |

---

## Редактирование

### Вырезание (cut)

В Vim `d` — это не удаление, а **вырезание**: текст исчезает с экрана, но сохраняется в буфере. Его можно вставить обратно через `p` — точно как Ctrl+X в обычных редакторах.

| Клавиша     | Действие                               |
|-------------|----------------------------------------|
| `x`         | Вырезать символ под курсором           |
| `X`         | Вырезать символ перед курсором         |
| `dd`        | Вырезать строку целиком                |
| `D`         | Вырезать от курсора до конца строки    |
| `dw`        | Вырезать слово                         |
| `diw`       | Вырезать слово (без пробелов вокруг)   |
| `dip`       | Вырезать абзац                         |
| `di"`       | Вырезать содержимое "..."              |
| `da"`       | Вырезать "..." вместе с кавычками      |
| `di(`       | Вырезать содержимое (...)              |

### Удаление без сохранения

Если нужно удалить текст по-настоящему (без сохранения в буфере), используй регистр "чёрная дыра" `"_`:

| Клавиша     | Действие                               |
|-------------|----------------------------------------|
| `"_d{...}`  | Удалить без сохранения (по движению)   |
| `"_dd`      | Удалить строку без сохранения          |
| `"_x`       | Удалить символ без сохранения          |

### Замена (вырезать + режим вставки)

Команда `c` — как `d`, но после вырезания сразу переходит в режим вставки. Удобно для замены текста.

| Клавиша     | Действие                           |
|-------------|-------------------------------------|
| `cc`        | Заменить всю строку                |
| `C`         | Заменить от курсора до конца строки |
| `cw`        | Заменить слово                     |
| `ciw`       | Заменить слово целиком             |
| `ci"`       | Заменить содержимое "..."          |
| `ci(`       | Заменить содержимое (...)          |
| `r{x}`      | Заменить один символ на x (без перехода в режим вставки) |

### Копирование и вставка

Три базовых действия — как в обычных редакторах:
- `d` = вырезать (Ctrl+X)
- `y` = копировать (Ctrl+C). В Vim это называется yank
- `p` = вставить (Ctrl+V)

| Клавиша     | Действие                           |
|-------------|-------------------------------------|
| `yy` / `Y`  | Копировать строку                  |
| `yiw`       | Копировать слово                   |
| `y{...}`    | Копировать по движению             |
| `p`         | Вставить после курсора             |
| `P`         | Вставить перед курсором            |
| `"+y`       | Копировать в системный буфер обмена (чтобы вставить в другую программу) |
| `"+p`       | Вставить из системного буфера обмена |

### Отмена / Повтор

| Клавиша | Действие                            |
|---------|--------------------------------------|
| `u`     | Отменить (как Ctrl+Z)               |
| `C-r`   | Повторить отменённое (как Ctrl+Shift+Z) |
| `.`     | Повторить последнее действие        |

### Форматирование

| Клавиша      | Действие                           |
|--------------|------------------------------------|
| `>>`         | Сдвинуть строку вправо (добавить отступ) |
| `<<`         | Сдвинуть строку влево              |
| `==`         | Автоформатирование строки          |
| `gg=G`       | Автоформатирование всего файла     |
| `J`          | Соединить текущую строку со следующей |
| `~`          | Переключить регистр символа (a↔A)  |
| `guw`        | Слово в нижний регистр             |
| `gUw`        | Слово в верхний регистр            |

---

## Текстовые объекты

Текстовые объекты — это способ сказать Vim **что** именно ты хочешь обработать. Они используются после действия (`d`, `c`, `y`, `v`).

Паттерн: **действие + `i` (inner, внутри) или `a` (around, включая) + объект**

Примеры:
- `diw` — "вырезать внутри слова" (вырежет слово, не трогая пробелы)
- `ci"` — "заменить внутри кавычек" (удалит текст между `"..."` и начнёт печатать)
- `yap` — "копировать абзац вместе с пустыми строками вокруг"

| Объект | С `i` (внутри)              | С `a` (включая)                  |
|--------|-----------------------------|----------------------------------|
| `w`    | Слово                       | Слово + пробел вокруг            |
| `s`    | Предложение                 | Предложение + пробел             |
| `p`    | Абзац                       | Абзац + пустые строки            |
| `"`    | Содержимое `"..."`          | `"..."` вместе с кавычками       |
| `'`    | Содержимое `'...'`          | `'...'` вместе с кавычками       |
| `)`    | Содержимое `(...)`          | `(...)` вместе со скобками       |
| `]`    | Содержимое `[...]`          | `[...]` вместе со скобками       |
| `}`    | Содержимое `{...}`          | `{...}` вместе со скобками       |
| `t`    | Содержимое HTML-тега        | HTML-тег полностью               |

---

## Поиск и замена

### Поиск

| Клавиша    | Действие                               |
|------------|-----------------------------------------|
| `/текст`   | Искать вперёд (нажми Enter для поиска) |
| `?текст`   | Искать назад                           |
| `n`        | Следующее совпадение                   |
| `N`        | Предыдущее совпадение                  |
| `*`        | Найти слово под курсором (вперёд)      |
| `#`        | Найти слово под курсором (назад)       |
| `:noh`     | Убрать подсветку результатов поиска    |

### Замена

Формат: `:[диапазон]s/старое/новое/[флаги]`

| Команда              | Действие                             |
|----------------------|--------------------------------------|
| `:s/foo/bar/`        | Первое вхождение в текущей строке    |
| `:s/foo/bar/g`       | Все вхождения в текущей строке       |
| `:%s/foo/bar/g`      | Все вхождения во всём файле          |
| `:%s/foo/bar/gc`     | Все в файле, с подтверждением каждого |
| `:'<,'>s/foo/bar/g`  | В выделенном фрагменте              |

---

## Окна и вкладки

### Окна (разделение экрана)

| Клавиша / Команда | Действие                           |
|-------------------|------------------------------------|
| `C-w s` / `:sp`  | Разделить горизонтально            |
| `C-w v` / `:vsp` | Разделить вертикально              |
| `C-w h/j/k/l`    | Переключиться на окно ←↓↑→ (алиас: `C-h/j/k/l`) |
| `C-w =`          | Выровнять размеры окон             |
| `C-w q` / `:q`   | Закрыть окно                       |
| `C-w o` / `:on`  | Оставить только текущее окно       |

### Вкладки

| Команда / Клавиша | Действие                           |
|-------------------|------------------------------------|
| `:tabnew`         | Новая вкладка                      |
| `gt` / `gT`      | Следующая / предыдущая вкладка     |
| `:tabc`           | Закрыть вкладку                    |

---

## Буферы

Буферы — это открытые файлы. В Vim может быть много буферов одновременно, даже если ты видишь только один.

| Команда       | Действие                           |
|---------------|------------------------------------|
| `:ls`         | Показать список открытых буферов   |
| `:b [N/имя]`  | Переключиться на буфер            |
| `:bn` / `:bp` | Следующий / предыдущий буфер       |
| `:bd`         | Закрыть буфер                      |
| `C-^`         | Переключиться на предыдущий буфер  |

---

## Закладки (marks)

Закладки позволяют отметить место в файле и быстро к нему вернуться.

| Клавиша      | Действие                                  |
|--------------|-------------------------------------------|
| `m{a-z}`     | Поставить закладку (строчная — в текущем файле) |
| `m{A-Z}`     | Поставить глобальную закладку (между файлами) |
| `` `{буква}`` | Перейти на закладку                      |
| `'{буква}`   | Перейти на строку с закладкой             |
| `:marks`     | Показать все закладки                     |

---

## Макросы

Макрос — это запись последовательности нажатий клавиш, которую можно воспроизвести. Полезно для повторяющихся действий.

| Клавиша     | Действие                           |
|-------------|-------------------------------------|
| `q{a-z}`    | Начать запись макроса (в регистр, например `qa`) |
| `q`         | Остановить запись                  |
| `@{a-z}`    | Воспроизвести макрос (например, `@a`) |
| `@@`        | Повторить последний макрос         |
| `[N]@{a-z}` | Воспроизвести N раз               |

---

## Регистры (буферы обмена)

В Vim не один буфер обмена, а много — они называются регистрами. Вот самые нужные:

| Регистр | Что в нём хранится                         |
|---------|---------------------------------------------|
| `""`    | Последний вырезанный или скопированный текст (используется по умолчанию) |
| `"0`    | Последний скопированный текст (только `y`, не `d`) — полезно, когда вырезал что-то и не хочешь потерять скопированное |
| `"+`    | Системный буфер обмена (обмен с другими программами) |
| `"_`    | "Чёрная дыра" — текст исчезает бесследно. Используй `"_d` чтобы удалить без сохранения |

Чтобы использовать конкретный регистр, набери `"` + буква регистра перед командой. Например: `"0p` — вставить из регистра 0.

<details>
<summary>Продвинутые регистры</summary>

| Регистр    | Описание                               |
|------------|----------------------------------------|
| `"1`–`"9`  | История вырезаний (1 = последнее)      |
| `"a`–`"z`  | Именованные (строчная — заменить)      |
| `"A`–`"Z`  | Именованные (заглавная — добавить к существующему) |
| `"*`       | Первичный буфер (выделение мышью, Linux) |
| `"/`       | Последний поиск                        |
| `":`       | Последняя команда                      |
| `"%`       | Имя текущего файла                     |

</details>

Просмотр: `:reg` или `:reg a b c`

---

## Визуальный режим

Визуальный режим — это выделение текста (как мышкой или Shift+стрелки в обычных редакторах). После выделения можно применить действие: вырезать (`d`), скопировать (`y`), сдвинуть (`>`) и т.д.

| Клавиша | Действие                           |
|---------|------------------------------------|
| `v`     | Посимвольное выделение             |
| `V`     | Построчное выделение               |
| `C-v`   | Блочное (прямоугольное) выделение  |
| `o`     | Переместить курсор на другой конец выделения |
| `gv`    | Восстановить последнее выделение   |
| `>`     | Сдвиг вправо                       |
| `<`     | Сдвиг влево                        |
| `=`     | Автоформатирование                 |
| `~`     | Переключить регистр                |
| `I`     | Вставить текст в начало каждой строки блока |
| `A`     | Вставить текст в конец каждой строки блока |

---

## Файлы и сессии

| Команда              | Действие                           |
|----------------------|------------------------------------|
| `:e {файл}`         | Открыть файл                       |
| `:w`                 | Сохранить                          |
| `:w {файл}`         | Сохранить как                      |
| `:q`                 | Закрыть                            |
| `:q!`                | Закрыть без сохранения             |
| `:wq` / `ZZ`        | Сохранить и закрыть                |
| `:qa!`               | Закрыть всё без сохранения         |

---

## Командный режим (`:`)

| Клавиша     | Действие                           |
|-------------|-------------------------------------|
| `Tab`       | Автодополнение                     |
| `C-p / C-n` | Предыдущая / следующая команда    |
| `C-r C-w`   | Вставить слово под курсором       |
| `q:`        | Открыть историю команд как буфер  |
| `@:`        | Повторить последнюю команду       |

---

## Полезные команды

### Навигация по коду (LSP)

LSP (Language Server Protocol) — это подсказки, автодополнение и навигация по коду, как в VS Code.

| Клавиша    | Действие                           |
|------------|------------------------------------|
| `gd`       | Перейти к определению функции/переменной |
| `gD`       | Перейти к объявлению               |
| `gr`       | Показать все места использования   |
| `gi`       | Перейти к реализации               |
| `K`        | Показать документацию (всплывающее окно) |
| `C-o`      | Вернуться назад (после перехода)   |
| `C-i`      | Вперёд (отменить C-o)             |

### Свёртка кода (folding)

| Клавиша | Действие                           |
|---------|------------------------------------|
| `za`    | Свернуть / развернуть блок кода    |
| `zo`    | Развернуть                         |
| `zc`    | Свернуть                           |
| `zR`    | Развернуть всё                     |
| `zM`    | Свернуть всё                       |

### Числа

| Клавиша  | Действие                           |
|----------|------------------------------------|
| `C-a`    | Увеличить число под курсором       |
| `C-x`    | Уменьшить число под курсором       |

### Прочее

| Клавиша / Команда | Действие                           |
|-------------------|------------------------------------|
| `:!{cmd}`         | Выполнить shell-команду            |
| `!!{cmd}`         | Заменить строку выводом команды    |
| `:set nu`         | Включить номера строк              |
| `:set rnu`        | Включить относительные номера      |
| `:set wrap`       | Включить перенос строк             |

---

## Диагностика и справка

| Команда          | Действие                              |
|------------------|---------------------------------------|
| `:help {тема}`   | Открыть встроенную справку            |
| `:checkhealth`   | Проверка состояния Neovim             |
| `:version`       | Версия и опции сборки                 |
| `:messages`      | История сообщений                     |
| `:map`           | Все активные горячие клавиши          |

---

## Кастомные клавиши (конфиг)

Эти клавиши заданы в конфигурации Neovim и могут отличаться от стандартных.

### Основные (keymaps.lua)

| Клавиша             | Действие                                     |
|---------------------|----------------------------------------------|
| `C-s`               | Сохранить файл                               |
| `jk` (insert)       | Выйти из режима вставки                      |
| `Esc` (normal)      | Убрать подсветку поиска                      |
| `C-h/j/k/l`        | Навигация между окнами                       |
| `Tab` / `S-Tab`    | Следующий / предыдущий буфер                 |
| `<leader>x`        | Закрыть буфер                                |
| `J` / `K` (visual)  | Переместить строки вниз / вверх             |
| `<` / `>` (visual)  | Отступ (остаёмся в visual mode)             |
| `p` (visual)        | Вставить без потери буфера обмена            |

### LSP (lsp.lua)

| Клавиша        | Действие                   |
|----------------|-----------------------------|
| `gd`           | Перейти к определению       |
| `gD`           | Перейти к декларации        |
| `gi`           | Перейти к реализации        |
| `gr`           | Показать референсы          |
| `K`            | Документация (hover)        |
| `<leader>rn`   | Переименовать символ       |
| `<leader>ca`   | Code action                |
| `<leader>e`    | Показать ошибку (float)    |
| `[d` / `]d`   | Предыдущая / следующая ошибка |

### Автодополнение (completion.lua)

| Клавиша         | Действие                           |
|-----------------|------------------------------------|
| `C-j` / `C-k`  | Следующий / предыдущий пункт      |
| `Tab` / `S-Tab` | Следующий пункт / jump в сниппете |
| `CR`            | Подтвердить выбор                  |
| `C-Space`       | Открыть дополнение вручную         |
| `C-e`           | Закрыть дополнение                 |
| `C-b` / `C-f`  | Скролл документации               |

### Telescope (telescope.lua)

| Клавиша        | Действие                           |
|----------------|------------------------------------|
| `<leader>ff`   | Найти файл                        |
| `<leader>fg`   | Поиск по проекту (live grep)      |
| `<leader>fb`   | Открытые буферы                   |
| `<leader>fr`   | Недавние файлы                    |
| `<leader>fc`   | Найти слово под курсором          |
| `<leader>fh`   | Справка Neovim                    |

> **Внутри Telescope:**
> - `C-j` / `C-k` — следующий / предыдущий
> - `C-q` — отправить в quickfix list
> - `Esc` — закрыть

### Проводник (explorer.lua — Neo-tree)

| Клавиша        | Действие                           |
|----------------|------------------------------------|
| `<leader>n`    | Файловое дерево (toggle)           |
| `<leader>N`    | Показать текущий файл в дереве     |

### Отладка (dap.lua)

| Клавиша        | Действие                           |
|----------------|------------------------------------|
| `F5`           | Запустить / продолжить             |
| `F10`          | Шаг через (step over)              |
| `F11`          | Шаг внутрь (step into)             |
| `F12`          | Шаг наружу (step out)              |
| `<leader>db`   | Брейкпоинт (toggle)               |
| `<leader>dB`   | Условный брейкпоинт               |
| `<leader>dr`   | Перезапустить                      |
| `<leader>dq`   | Остановить                         |
| `<leader>du`   | Открыть/закрыть UI                 |
| `<leader>de`   | Вычислить выражение (n/v)          |
| `<leader>dt`   | Дебажить тест под курсором (Go)    |
| `<leader>dl`   | Повторить последний тест (Go)      |

### Тесты (neotest.lua)

| Клавиша        | Действие                           |
|----------------|------------------------------------|
| `<leader>tr`   | Тест под курсором                  |
| `<leader>tR`   | Все тесты в файле                  |
| `<leader>ts`   | Панель тестов (toggle)             |
| `<leader>to`   | Вывод теста                        |
| `<leader>tO`   | Панель вывода (снизу)              |
| `<leader>tS`   | Остановить тест                    |
| `<leader>td`   | Дебажить тест                      |
| `]t` / `[t`   | Следующий / предыдущий провалившийся |

### Терминал (terminal.lua)

| Клавиша          | Действие                           |
|------------------|------------------------------------|
| `C-\`            | Терминал (toggle, n/t)             |
| `Esc` (terminal) | Выйти из terminal mode            |

### Буферы (bufferline.lua)

| Клавиша        | Действие                           |
|----------------|------------------------------------|
| `<leader>1–5`  | Перейти к буферу 1–5               |

### Go (gopher.lua)

| Клавиша        | Действие                           |
|----------------|------------------------------------|
| `<leader>cj`   | Добавить json теги                 |
| `<leader>cy`   | Добавить yaml теги                 |
| `<leader>cJ`   | Убрать json теги                   |
| `<leader>ce`   | `if err != nil`                    |
| `<leader>ci`   | Реализовать интерфейс              |
| `<leader>cm`   | `go mod tidy`                      |

### Форматирование (formatting.lua)

| Клавиша        | Действие                           |
|----------------|------------------------------------|
| `<leader>p`    | Форматировать файл (n/v)           |

### Surround (editing.lua — nvim-surround)

| Клавиша        | Действие                           |
|----------------|------------------------------------|
| `ysiw"`        | Обернуть слово в `""`              |
| `ds"`          | Убрать кавычки                     |
| `cs"'`         | Заменить `"` на `'`                |

### TODO (editing.lua — todo-comments)

| Клавиша        | Действие                           |
|----------------|------------------------------------|
| `<leader>ft`   | Найти TODO в проекте               |

---

## Git (плагины)

### Neogit — `<leader>gg`

| Клавиша       | Действие                                      |
|---------------|-----------------------------------------------|
| `<leader>gg`  | Открыть Neogit (статус-буфер, всё остальное внутри) |

> **Внутри Neogit:**
> - `s` — stage файл/hunk
> - `u` — unstage
> - `x` — discard changes
> - `c` — commit popup
> - `P` — push popup
> - `p` — pull popup
> - `b` — branch popup (switch, create, delete)
> - `m` — merge popup
> - `Z` — stash popup
> - `l` — log popup
> - `d` — diff popup
> - `Tab` — развернуть/свернуть секцию
> - `q` — закрыть Neogit

### Gitsigns — `<leader>h` (hunks)

| Клавиша       | Действие                           |
|---------------|------------------------------------|
| `]h / [h`     | Следующий / предыдущий hunk        |
| `<leader>hs`  | Stage hunk                         |
| `<leader>hr`  | Reset hunk                         |
| `<leader>hu`  | Undo stage hunk                    |
| `<leader>hS`  | Stage весь файл                    |
| `<leader>hR`  | Reset весь файл                    |
| `<leader>hp`  | Preview hunk                       |
| `<leader>hd`  | Diff файла                         |
| `<leader>hb`  | Blame строки                       |
| `<leader>hB`  | Blame (полный коммит)              |
| `<leader>ht`  | Toggle inline blame                |

---

*Используй `/текст` прямо в этом файле для быстрой навигации по шпаргалке*
